<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nritya AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            overflow-x: hidden;
        }

        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 15px 0;
            border-bottom: 1px solid rgba(233, 69, 96, 0.3);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e94560;
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            transition: color 0.3s;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            color: #f27121;
        }

        /* Pages */
        .page {
            display: none;
            min-height: 100vh;
            padding: 80px 20px 20px;
        }

        .page.active {
            display: block;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Landing Page */
        .hero {
            text-align: center;
            padding: 100px 0;
        }

        .hero h1 {
            font-size: 4rem;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #e94560, #f27121);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 10px rgba(233, 69, 96, 0.5)); }
            to { filter: drop-shadow(0 0 20px rgba(242, 113, 33, 0.8)); }
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .cta-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(45deg, #e94560, #f27121);
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn.secondary {
            background: transparent;
            border: 2px solid #f27121;
        }

        /* Live Tracking Page */
        .tracking-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .video-section {
            background: rgba(30, 30, 60, 0.6);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(233, 69, 96, 0.3);
        }

        .video-container {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        #video {
            width: 100%;
            height: auto;
            border-radius: 15px;
        }

        #poseCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .data-section {
            background: rgba(30, 30, 60, 0.6);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(242, 113, 33, 0.3);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat {
            text-align: center;
            padding: 10px;
            background: rgba(233, 69, 96, 0.1);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f27121;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* Choreography Page */
        .choreo-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-top: 20px;
        }

        .choreo-controls {
            background: rgba(30, 30, 60, 0.6);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(233, 69, 96, 0.3);
        }

        .choreo-canvas-container {
            background: rgba(30, 30, 60, 0.6);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(242, 113, 33, 0.3);
        }

        #choreoCanvas {
            width: 100%;
            height: 400px;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.3);
        }

        .dance-style {
            margin-bottom: 20px;
        }

        .dance-style label {
            display: block;
            margin-bottom: 10px;
            color: #f27121;
            font-weight: 600;
        }

        .dance-style select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(233, 69, 96, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .pose-list {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
        }

        .pose-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 5px;
            background: rgba(233, 69, 96, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .pose-item:hover {
            background: rgba(233, 69, 96, 0.2);
        }

        .pose-item.active {
            background: rgba(242, 113, 33, 0.3);
        }

        /* Gallery Page */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .gallery-item {
            background: rgba(30, 30, 60, 0.6);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(233, 69, 96, 0.3);
            text-align: center;
        }

        .gallery-thumbnail {
            width: 100%;
            height: 150px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tracking-container, .choreo-container {
                grid-template-columns: 1fr;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .nav-links {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <div class="logo" id="navHome" style="cursor:pointer;">Nritya AI</div>
            <div class="nav-links">
                <a href="#" class="nav-link active" data-page="home">Home</a>
                <a href="#" class="nav-link" data-page="tracking">Live Tracking</a>
                <a href="#" class="nav-link" data-page="choreography">Choreography</a>
                <a href="#" class="nav-link" data-page="gallery">Gallery</a>
                <a href="#" class="nav-link" data-page="instructor">Virtual Dance Instructor</a>
            </div>
        </div>
    </nav>

    <!-- Home Page -->
    <div class="page active" id="home">
        <div class="container">
            <div class="hero">
                <h1>Nritya AI</h1>
                <p>Professional Motion Capture & Dance Choreography Generation</p>
                <div class="cta-buttons">
                    <a href="#" class="btn" data-page="tracking">Start Live Tracking</a>
                    <a href="#" class="btn secondary" data-page="choreography">Generate Choreography</a>
                </div>
            </div>
            <div style="margin: 60px auto 0 auto; max-width: 800px; background: rgba(30,30,60,0.7); border-radius: 18px; padding: 32px 24px;">
                <h2 style="color:#f27121; text-align:center; margin-bottom:18px;">What is Nritya AI?</h2>
                <p style="font-size:1.15rem; line-height:1.7; text-align:center;">
                    <b>Nritya AI</b> is an AI-powered platform for dancers, choreographers, and learners.<br>
                    <span style="color:#e94560;">Capture your dance moves in real-time, generate creative choreography, and explore the beauty of Indian dance heritage.</span>
                </p>
                <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:30px; margin-top:32px;">
                    <div style="flex:1 1 220px; min-width:220px; background:rgba(233,69,96,0.08); border-radius:12px; padding:18px;">
                        <h3 style="color:#f27121;">ðŸŽ¥ Live Motion Tracking</h3>
                        <p style="font-size:1rem;">Track your dance poses using your webcam and get instant feedback on your movements.</p>
                    </div>
                    <div style="flex:1 1 220px; min-width:220px; background:rgba(233,69,96,0.08); border-radius:12px; padding:18px;">
                        <h3 style="color:#f27121;">ðŸ•º Choreography Generator</h3>
                        <p style="font-size:1rem;">Generate unique dance sequences for Bollywood, Kathak, Hip-Hop, and Contemporary styles.</p>
                    </div>
                    <div style="flex:1 1 220px; min-width:220px; background:rgba(233,69,96,0.08); border-radius:12px; padding:18px;">
                        <h3 style="color:#f27121;">ðŸ“š Learn & Explore</h3>
                        <p style="font-size:1rem;">Discover the heritage of Indian dance, learn new moves, and save your favorite poses in the gallery.</p>
                    </div>
                </div>
                <div style="margin-top:36px; text-align:center;">
                    <a href="#" class="btn" data-page="about" style="margin-right:15px;">About</a>
                    <a href="#" class="btn secondary" data-page="gallery">View Gallery</a>
                </div>
            </div>
            <div style="margin: 60px auto 0 auto; max-width: 800px; background: rgba(242,113,33,0.07); border-radius: 14px; padding: 22px 18px;">
                <h3 style="color:#e94560; margin-bottom:10px;">âœ¨ Why Nritya AI?</h3>
                <ul style="font-size:1.05rem; line-height:1.7; color:#fff; margin-left:20px;">
                    <li>Easy-to-use, browser-based experience</li>
                    <li>Supports multiple Indian and global dance styles</li>
                    <li>Save, review, and share your dance poses and sequences</li>
                    <li>Perfect for solo practice, group choreography, and teaching</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Live Tracking Page -->
    <div class="page" id="tracking">
        <div class="container">
            <h2 style="text-align: center; margin-bottom: 30px; color: #f27121;">Live Motion Tracking</h2>
            <div style="margin-bottom:24px; text-align:center;">
                <label for="musicSelect" style="color:#f27121; font-weight:bold;">Select Music:</label>
                <select id="musicSelect" style="padding:8px; border-radius:8px; margin-left:10px;">
                    <option value="">-- Choose a track --</option>
                    <option value="music1.mp3">Bollywood Groove</option>
                    <option value="music2.mp3">Kathak Beats</option>
                    <option value="music3.mp3">Hip-Hop Jam</option>
                    <option value="music4.mp3">Contemporary Flow</option>
                </select>
                <audio id="musicPlayer" controls style="vertical-align:middle; margin-left:15px; display:none;"></audio>
            </div>
            <div class="tracking-container">
                <div class="video-section">
                    <div class="video-container">
                        <video id="video" autoplay muted playsinline></video>
                        <canvas id="poseCanvas"></canvas>
                        <canvas id="expectedPoseCanvas" style="position:absolute; top:0; left:0; pointer-events:none;"></canvas>
                    </div>
                    <div class="controls">
                        <button id="startTrackingBtn" class="btn">Start Tracking</button>
                        <button id="stopTrackingBtn" class="btn secondary">Stop Tracking</button>
                        <button id="captureBtn" class="btn">Capture Pose</button>
                        <button id="loadExpectedBtn" class="btn secondary">Load Expected Pose</button>
                    </div>
                    <div style="margin-top:10px; color:#f27121; text-align:center;" id="feedbackMsg"></div>
                </div>
                <div class="data-section">
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" id="frameCount">0</div>
                            <div class="stat-label">Frames</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="poseCount">0</div>
                            <div class="stat-label">Poses</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="accuracy">0%</div>
                            <div class="stat-label">Accuracy</div>
                        </div>
                    </div>
                    <div id="trackingLog" style="height: 200px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; font-family: monospace; font-size: 0.9rem;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Choreography Page -->
    <div class="page" id="choreography">
        <div class="container">
            <h2 style="text-align: center; margin-bottom: 30px; color: #f27121;">Choreography Generator</h2>
            <div class="choreo-container">
                <div class="choreo-controls">
                    <div class="dance-style">
                        <label>Dance Style:</label>
                        <select id="danceStyleSelect">
                            <option value="bollywood">Bollywood</option>
                            <option value="kathak">Kathak</option>
                            <option value="hiphop">Hip-Hop</option>
                            <option value="contemporary">Contemporary</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label>Duration (seconds):</label>
                        <input id="choreoDuration" type="number" min="2" max="60" value="10" style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #e94560; background: rgba(255,255,255,0.07); color: white;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label>Tempo:</label>
                        <select id="choreoTempo" style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #e94560; background: rgba(255,255,255,0.07); color: white;">
                            <option value="slow">Slow</option>
                            <option value="medium" selected>Medium</option>
                            <option value="fast">Fast</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label>Complexity:</label>
                        <select id="choreoComplexity" style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #e94560; background: rgba(255,255,255,0.07); color: white;">
                            <option value="beginner">Beginner</option>
                            <option value="intermediate" selected>Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                    <button id="generateBtn" class="btn" style="width: 100%; margin-bottom: 20px;">Generate Choreography</button>
                    <div style="margin-bottom: 20px;">
                        <button id="playBtn" class="btn">Play</button>
                        <button id="pauseBtn" class="btn secondary">Pause</button>
                        <button id="resetBtn" class="btn secondary">Reset</button>
                        <button id="previewBtn" class="btn secondary" style="float:right;">Preview Moves</button>
                    </div>
                    <div id="choreoMeta" style="margin-bottom: 10px; color: #f27121; font-size: 0.95rem;"></div>
                    <div class="pose-list" id="poseList">
                        <div style="text-align: center; color: #999;">Generate choreography to see poses</div>
                    </div>
                </div>
                <div class="choreo-canvas-container">
                    <canvas id="choreoCanvas"></canvas>
                    <div style="text-align: center; margin-top: 15px;">
                        <span id="currentPose">Pose: 0/0</span>
                        <span style="margin-left: 20px;" id="playbackSpeed">Speed: 1x</span>
                    </div>
                    <div id="previewModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.85); z-index:2000; align-items:center; justify-content:center;">
                        <div style="background:#222; border-radius:15px; padding:30px; max-width:600px; max-height:80vh; overflow:auto; color:white; position:relative;">
                            <button id="closePreviewBtn" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#e94560; font-size:1.5rem; cursor:pointer;">&times;</button>
                            <h3 style="color:#f27121; margin-bottom:15px;">Choreography Moves & Keyframes</h3>
                            <div id="previewContent"></div>
                        </div>
                    </div>
                    <div id="choreoError" style="color:#e94560; text-align:center; margin-top:10px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gallery Page -->
    <div class="page" id="gallery">
        <div class="container">
            <h2 style="text-align: center; margin-bottom: 30px; color: #f27121;">Pose Gallery</h2>
            <div class="gallery-grid" id="galleryGrid">
                <!-- Gallery items will be populated here -->
            </div>
        </div>
    </div>

    <!-- About Page -->
    <div class="page" id="about">
        <div class="container">
            <h2 style="color:#f27121; text-align:center; margin-bottom:18px;">About Nritya AI</h2>
            <div id="aboutContent" style="margin-bottom:32px;">
                <div style="text-align:center; color:#aaa;">Loading...</div>
            </div>
            <div id="aboutTeam" style="margin-bottom:32px;"></div>
            <div id="aboutPhantomDance" style="margin-bottom:32px;"></div>
            <div id="aboutContact" style="margin-bottom:32px;"></div>
        </div>
    </div>

    <!-- Virtual Dance Instructor Page -->
    <div class="page" id="instructor">
        <div class="container">
            <h2 style="color:#f27121; text-align:center; margin-bottom:30px;">Virtual Dance Instructor</h2>
            <div style="display:flex; flex-wrap:wrap; gap:32px;">
                <div style="flex:1 1 350px; min-width:320px;">
                    <div style="background:rgba(30,30,60,0.7); border-radius:18px; padding:24px;">
                        <h3 style="color:#f27121; margin-bottom:12px;">How it works</h3>
                        <ul style="font-size:1.05rem; line-height:1.7; color:#fff;">
                            <li>Select a dance style and move from PhantomDance library.</li>
                            <li>Preview the reference animation and keyframes.</li>
                            <li>Start your webcam and follow the instructor's moves.</li>
                            <li>Get real-time feedback on correctness, timing, and fluidity.</li>
                        </ul>
                        <div style="margin-top:18px;">
                            <label for="instructorStyleSelect" style="color:#f27121;">Dance Style:</label>
                            <select id="instructorStyleSelect" style="width:100%;padding:8px;border-radius:8px;margin-top:8px;">
                                <option value="">-- Select style --</option>
                            </select>
                        </div>
                        <div style="margin-top:18px;">
                            <label for="instructorMoveSelect" style="color:#f27121;">Move:</label>
                            <select id="instructorMoveSelect" style="width:100%;padding:8px;border-radius:8px;margin-top:8px;">
                                <option value="">-- Select move --</option>
                            </select>
                            <button class="btn" id="previewInstructorMoveBtn" style="margin-top:10px;">Preview Move</button>
                            <button class="btn" id="loadInstructorMoveBtn" style="margin-top:10px;">Load Move</button>
                        </div>
                        <div style="margin-top:18px;">
                            <button class="btn" id="instructorStartBtn">Start Instructor</button>
                            <button class="btn secondary" id="instructorStopBtn">Stop</button>
                        </div>
                        <div id="instructorStatus" style="margin-top:14px; color:#f27121;"></div>
                    </div>
                </div>
                <div style="flex:2 1 500px; min-width:320px;">
                    <div style="position:relative; background:rgba(30,30,60,0.7); border-radius:18px; padding:18px;">
                        <canvas id="instructorReferenceCanvas" style="width:100%; border-radius:12px; background:#181818; margin-bottom:10px;"></canvas>
                        <video id="instructorVideo" style="width:100%; border-radius:12px; display:none;" controls></video>
                        <canvas id="instructorWebcam" style="width:100%; border-radius:12px; display:none;"></canvas>
                        <canvas id="instructorPoseCanvas" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none;"></canvas>
                        <div id="instructorFeedback" style="margin-top:12px; color:#f27121; text-align:center;"></div>
                        <div id="instructorPreviewModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.85); z-index:2000; align-items:center; justify-content:center;">
                            <div style="background:#222; border-radius:15px; padding:30px; max-width:600px; max-height:80vh; overflow:auto; color:white; position:relative;">
                                <button id="closeInstructorPreviewBtn" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#e94560; font-size:1.5rem; cursor:pointer;">&times;</button>
                                <h3 style="color:#f27121; margin-bottom:15px;">Move Preview & Keyframes</h3>
                                <div id="instructorPreviewContent"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- About Page -->
    <div class="page" id="about">
        <div class="container">
            <h2 style="color:#f27121; text-align:center; margin-bottom:18px;">About Nritya AI</h2>
            <div id="aboutContent" style="margin-bottom:32px;">
                <div style="text-align:center; color:#aaa;">Loading...</div>
            </div>
            <div id="aboutTeam" style="margin-bottom:32px;"></div>
            <div id="aboutPhantomDance" style="margin-bottom:32px;"></div>
            <div id="aboutContact" style="margin-bottom:32px;"></div>
        </div>
    </div>

    <!-- Virtual Dance Instructor Page -->
    <div class="page" id="instructor">
        <div class="container">
            <h2 style="color:#f27121; text-align:center; margin-bottom:30px;">Virtual Dance Instructor</h2>
            <div style="display:flex; flex-wrap:wrap; gap:32px;">
                <div style="flex:1 1 350px; min-width:320px;">
                    <div style="background:rgba(30,30,60,0.7); border-radius:18px; padding:24px;">
                        <h3 style="color:#f27121; margin-bottom:12px;">How it works</h3>
                        <ul style="font-size:1.05rem; line-height:1.7; color:#fff;">
                            <li>Select a dance style and move from PhantomDance library.</li>
                            <li>Preview the reference animation and keyframes.</li>
                            <li>Start your webcam and follow the instructor's moves.</li>
                            <li>Get real-time feedback on correctness, timing, and fluidity.</li>
                        </ul>
                        <div style="margin-top:18px;">
                            <label for="instructorStyleSelect" style="color:#f27121;">Dance Style:</label>
                            <select id="instructorStyleSelect" style="width:100%;padding:8px;border-radius:8px;margin-top:8px;">
                                <option value="">-- Select style --</option>
                            </select>
                        </div>
                        <div style="margin-top:18px;">
                            <label for="instructorMoveSelect" style="color:#f27121;">Move:</label>
                            <select id="instructorMoveSelect" style="width:100%;padding:8px;border-radius:8px;margin-top:8px;">
                                <option value="">-- Select move --</option>
                            </select>
                            <button class="btn" id="previewInstructorMoveBtn" style="margin-top:10px;">Preview Move</button>
                            <button class="btn" id="loadInstructorMoveBtn" style="margin-top:10px;">Load Move</button>
                        </div>
                        <div style="margin-top:18px;">
                            <button class="btn" id="instructorStartBtn">Start Instructor</button>
                            <button class="btn secondary" id="instructorStopBtn">Stop</button>
                        </div>
                        <div id="instructorStatus" style="margin-top:14px; color:#f27121;"></div>
                    </div>
                </div>
                <div style="flex:2 1 500px; min-width:320px;">
                    <div style="position:relative; background:rgba(30,30,60,0.7); border-radius:18px; padding:18px;">
                        <canvas id="instructorReferenceCanvas" style="width:100%; border-radius:12px; background:#181818; margin-bottom:10px;"></canvas>
                        <video id="instructorVideo" style="width:100%; border-radius:12px; display:none;" controls></video>
                        <canvas id="instructorWebcam" style="width:100%; border-radius:12px; display:none;"></canvas>
                        <canvas id="instructorPoseCanvas" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none;"></canvas>
                        <div id="instructorFeedback" style="margin-top:12px; color:#f27121; text-align:center;"></div>
                        <div id="instructorPreviewModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.85); z-index:2000; align-items:center; justify-content:center;">
                            <div style="background:#222; border-radius:15px; padding:30px; max-width:600px; max-height:80vh; overflow:auto; color:white; position:relative;">
                                <button id="closeInstructorPreviewBtn" style="position:absolute; top:10px; right:15px; background:none; border:none; color:#e94560; font-size:1.5rem; cursor:pointer;">&times;</button>
                                <h3 style="color:#f27121; margin-bottom:15px;">Move Preview & Keyframes</h3>
                                <div id="instructorPreviewContent"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/pose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.5/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.5/camera_utils.js"></script>
    <script>
        // === Backend API URL ===
        const BACKEND_URL = "http://127.0.0.1:8000";

        // Utility: Convert canvas to base64 image
        function canvasToBase64(canvas) {
            return canvas.toDataURL("image/png");
        }

        // Utility: Draw pose landmarks
        function drawLandmarks(ctx, landmarks, color="#f27121") {
            if (!landmarks || landmarks.length === 0) return;
            ctx.save();
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            ctx.lineWidth = 4;
            // Draw circles for each landmark
            for (const lm of landmarks) {
                ctx.beginPath();
                ctx.arc(lm.x, lm.y, 6, 0, 2 * Math.PI);
                ctx.fill();
            }
            ctx.restore();
        }

        // Utility: Compare two sets of landmarks (returns similarity score 0-1)
        function compareLandmarks(live, expected) {
            if (!live || !expected || live.length !== expected.length) return 0;
            let sum = 0, count = 0;
            for (let i = 0; i < live.length; ++i) {
                // Only compare visible landmarks
                if (live[i].visibility > 0.5 && expected[i].visibility > 0.5) {
                    const dx = live[i].x - expected[i].x;
                    const dy = live[i].y - expected[i].y;
                    sum += Math.sqrt(dx * dx + dy * dy);
                    count++;
                }
            }
            if (count === 0) return 0;
            // Normalize: lower is better, invert for similarity
            const avgDist = sum / count;
            // Assume max reasonable distance is 0.5 (normalized), similarity = 1 - (avgDist / 0.5)
            return Math.max(0, 1 - avgDist / 0.5);
        }

        // Router Class for Page Navigation
        class Router {
            constructor() {
                this.currentPage = 'home';
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.navigateTo(link.dataset.page);
                    });
                });

                document.querySelectorAll('[data-page]').forEach(element => {
                    element.addEventListener('click', (e) => {
                        if (element.dataset.page) {
                            e.preventDefault();
                            this.navigateTo(element.dataset.page);
                        }
                    });
                });
            }

            navigateTo(page) {
                // Hide current page
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));

                // Show new page
                document.getElementById(page).classList.add('active');
                document.querySelector(`[data-page="${page}"]`).classList.add('active');

                this.currentPage = page;
                
                // Initialize page-specific functionality
                this.initializePage(page);
            }

            initializePage(page) {
                switch(page) {
                    case 'tracking':
                        if (window.liveTracker) window.liveTracker.init();
                        break;
                    case 'choreography':
                        if (window.choreoGenerator) window.choreoGenerator.init();
                        break;
                    case 'gallery':
                        if (window.galleryManager) window.galleryManager.loadGallery();
                        break;
                }
            }
        }

        // Live Tracking Class
        class LiveTracker {
            constructor() {
                this.video = null;
                this.canvas = null;
                this.ctx = null;
                this.expectedCanvas = null;
                this.expectedCtx = null;
                this.isTracking = false;
                this.stats = { frameCount: 0, poseCount: 0, accuracy: 0 };
                this.lastPose = null;
                this.loading = false;
                this.expectedPose = null;
                this.musicSelected = false;
                this.musicPlayer = null;
                this.musicSelect = null;
            }

            init() {
                this.video = document.getElementById('video');
                this.canvas = document.getElementById('poseCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.expectedCanvas = document.getElementById('expectedPoseCanvas');
                this.expectedCtx = this.expectedCanvas.getContext('2d');
                this.expectedCanvas.width = this.canvas.width;
                this.expectedCanvas.height = this.canvas.height;
                this.setupCamera();
                this.setupEventListeners();
                this.musicPlayer = document.getElementById('musicPlayer');
                this.musicSelect = document.getElementById('musicSelect');
                this.musicSelected = false;
                this.setupMusicSelection();
                document.getElementById('feedbackMsg').textContent = '';
            }

            async setupCamera() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    this.video.srcObject = stream;
                    this.video.onloadedmetadata = () => {
                        this.canvas.width = this.video.videoWidth;
                        this.canvas.height = this.video.videoHeight;
                        this.expectedCanvas.width = this.video.videoWidth;
                        this.expectedCanvas.height = this.video.videoHeight;
                    };
                } catch (err) {
                    this.log('Camera access denied');
                }
            }

            setupEventListeners() {
                document.getElementById('startTrackingBtn').onclick = () => this.startTracking();
                document.getElementById('stopTrackingBtn').onclick = () => this.stopTracking();
                document.getElementById('captureBtn').onclick = () => this.captureFrame();
                document.getElementById('loadExpectedBtn').onclick = () => this.loadExpectedPose();
            }

            setupMusicSelection() {
                this.musicPlayer.pause();
                this.musicPlayer.style.display = 'none';
                this.musicSelect.value = "";
                // Only allow tracking after music is selected
                document.getElementById('startTrackingBtn').disabled = true;
                this.musicSelect.onchange = () => {
                    const val = this.musicSelect.value;
                    if (val) {
                        this.musicPlayer.src = `music/${val}`;
                        this.musicPlayer.style.display = '';
                        this.musicSelected = true;
                        document.getElementById('startTrackingBtn').disabled = false;
                    } else {
                        this.musicPlayer.pause();
                        this.musicPlayer.style.display = 'none';
                        this.musicSelected = false;
                        document.getElementById('startTrackingBtn').disabled = true;
                    }
                };
            }

            async loadExpectedPose() {
                // For demo: prompt user to upload a pose JSON file
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json,application/json';
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    const text = await file.text();
                    try {
                        const data = JSON.parse(text);
                        if (data.landmarks && data.landmarks.length > 0) {
                            this.expectedPose = data.landmarks;
                            this.drawExpectedPose();
                            document.getElementById('feedbackMsg').textContent = 'Expected pose loaded!';
                        } else {
                            document.getElementById('feedbackMsg').textContent = 'Invalid pose file.';
                        }
                    } catch {
                        document.getElementById('feedbackMsg').textContent = 'Invalid JSON file.';
                    }
                };
                input.click();
            }

            drawExpectedPose() {
                this.expectedCtx.clearRect(0, 0, this.expectedCanvas.width, this.expectedCanvas.height);
                if (!this.expectedPose) return;
                // Draw expected pose in blue
                const landmarks = this.expectedPose.map(lm => ({
                    x: lm.x * this.expectedCanvas.width,
                    y: lm.y * this.expectedCanvas.height,
                    visibility: lm.visibility
                }));
                drawLandmarks(this.expectedCtx, landmarks, "#2196f3");
            }

            startTracking() {
                if (this.isTracking) return;
                this.isTracking = true;
                this.log('Started live tracking');
                // Play music when tracking starts
                if (this.musicPlayer && this.musicPlayer.src) {
                    this.musicPlayer.currentTime = 0;
                    this.musicPlayer.play();
                }
                this.trackingLoop();
            }

            stopTracking() {
                this.isTracking = false;
                this.log('Stopped tracking');
                if (this.musicPlayer) {
                    this.musicPlayer.pause();
                }
            }

            async trackingLoop() {
                if (!this.isTracking) return;

                this.stats.frameCount++;
                this.updateStats();

                // Draw video frame
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.ctx.drawImage(this.video, 0, 0, this.canvas.width, this.canvas.height);

                // Draw expected pose overlay
                this.drawExpectedPose();

                // Send frame to backend for pose detection every 3rd frame
                if (this.stats.frameCount % 3 === 0 && !this.loading) {
                    this.loading = true;
                    try {
                        const imgData = this.canvas.toDataURL("image/jpeg");
                        const res = await fetch(`${BACKEND_URL}/pose`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ image_data: imgData })
                        });
                        if (res.ok) {
                            const data = await res.json();
                            if (data.landmarks && data.landmarks.length > 0) {
                                this.lastPose = data;
                                this.stats.poseCount++;
                                this.stats.accuracy = Math.round((this.stats.poseCount / this.stats.frameCount) * 100);
                                // Draw landmarks
                                this.drawPoseLandmarks(data.landmarks);
                                // Compare with expected pose if loaded
                                if (this.expectedPose) {
                                    const liveNorm = data.landmarks.map(lm => ({
                                        x: lm.x,
                                        y: lm.y,
                                        visibility: lm.visibility
                                    }));
                                    const sim = compareLandmarks(liveNorm, this.expectedPose);
                                    let msg = '';
                                    if (sim > 0.85) msg = 'Great! Your pose matches the instructor!';
                                    else if (sim > 0.65) msg = 'Good! Try to match the pose more closely.';
                                    else msg = 'Keep practicing to match the instructor pose!';
                                    document.getElementById('feedbackMsg').textContent = `Similarity: ${(sim*100).toFixed(1)}%. ${msg}`;
                                } else {
                                    document.getElementById('feedbackMsg').textContent = '';
                                }
                            }
                        } else {
                            const err = await res.json();
                            this.log("Pose error: " + (err.detail || "Unknown"));
                        }
                    } catch (e) {
                        this.log("API error: " + e.message);
                    }
                    this.loading = false;
                } else if (this.lastPose && this.lastPose.landmarks) {
                    this.drawPoseLandmarks(this.lastPose.landmarks);
                }

                requestAnimationFrame(() => this.trackingLoop());
            }

            drawPoseLandmarks(landmarks) {
                // Assume landmarks are normalized [0,1], scale to canvas
                for (const lm of landmarks) {
                    lm.x = lm.x * this.canvas.width;
                    lm.y = lm.y * this.canvas.height;
                }
                drawLandmarks(this.ctx, landmarks, "#f27121");
            }

            captureFrame() {
                this.log('Frame captured');
                // Save to gallery with thumbnail
                if (window.galleryManager) {
                    const name = this.lastPose && this.lastPose.pose_analysis && this.lastPose.pose_analysis.pose_type
                        ? this.lastPose.pose_analysis.pose_type
                        : "Captured Pose";
                    const img = canvasToBase64(this.canvas);
                    window.galleryManager.addPose(name, new Date(), img);
                }
            }

            updateStats() {
                document.getElementById('frameCount').textContent = this.stats.frameCount;
                document.getElementById('poseCount').textContent = this.stats.poseCount;
                document.getElementById('accuracy').textContent = this.stats.accuracy + '%';
            }

            log(message) {
                const logDiv = document.getElementById('trackingLog');
                const time = new Date().toLocaleTimeString();
                logDiv.innerHTML += `[${time}] ${message}<br>`;
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        }

        // Choreography Generator Class
        class ChoreographyGenerator {
            constructor() {
                this.canvas = null;
                this.ctx = null;
                this.currentSequence = [];
                this.currentPoseIndex = 0;
                this.isPlaying = false;
                this.playbackSpeed = 1000;
                this.loading = false;
                this.meta = {};
            }

            init() {
                this.canvas = document.getElementById('choreoCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.canvas.width = this.canvas.offsetWidth;
                this.canvas.height = this.canvas.offsetHeight;
                this.setupEventListeners();
                this.clearMeta();
                document.getElementById('choreoError').textContent = '';
            }

            setupEventListeners() {
                document.getElementById('generateBtn').onclick = () => this.generateChoreography();
                document.getElementById('playBtn').onclick = () => this.playSequence();
                document.getElementById('pauseBtn').onclick = () => this.pauseSequence();
                document.getElementById('resetBtn').onclick = () => this.resetSequence();
                document.getElementById('previewBtn').onclick = () => this.previewMoves();
                document.getElementById('closePreviewBtn').onclick = () => this.closePreview();
            }

            async generateChoreography() {
                const style = document.getElementById('danceStyleSelect').value;
                const duration = parseInt(document.getElementById('choreoDuration').value) || 10;
                const tempo = document.getElementById('choreoTempo').value;
                const complexity = document.getElementById('choreoComplexity').value;
                this.loading = true;
                document.getElementById('generateBtn').textContent = "Loading...";
                document.getElementById('choreoError').textContent = '';
                try {
                    const res = await fetch(`${BACKEND_URL}/choreography`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ style, duration, tempo, complexity })
                    });
                    if (res.ok) {
                        const data = await res.json();
                        this.currentSequence = data.sequence || [];
                        this.meta = {
                            duration: data.duration,
                            tempo: data.tempo,
                            complexity: data.complexity,
                            total_moves: data.total_moves
                        };
                        this.updateMeta();
                        this.updatePoseList();
                        this.drawPose(0);
                        this.updateCurrentPose();
                    } else {
                        const err = await res.json();
                        document.getElementById('choreoError').textContent = "Choreography error: " + (err.detail || "Unknown");
                        this.clearMeta();
                        this.updatePoseList();
                    }
                } catch (e) {
                    document.getElementById('choreoError').textContent = "API error: " + e.message;
                    this.clearMeta();
                    this.updatePoseList();
                }
                document.getElementById('generateBtn').textContent = "Generate Choreography";
                this.loading = false;
            }

            updateMeta() {
                const meta = this.meta;
                document.getElementById('choreoMeta').innerHTML =
                    `<b>Duration:</b> ${meta.duration}s &nbsp; <b>Tempo:</b> ${meta.tempo} &nbsp; <b>Complexity:</b> ${meta.complexity} &nbsp; <b>Total Moves:</b> ${meta.total_moves}`;
            }

            clearMeta() {
                document.getElementById('choreoMeta').innerHTML = '';
                this.meta = {};
            }

            updatePoseList() {
                const poseList = document.getElementById('poseList');
                poseList.innerHTML = '';
                if (!this.currentSequence.length) {
                    poseList.innerHTML = '<div style="text-align: center; color: #999;">No choreography generated</div>';
                    return;
                }
                this.currentSequence.forEach((pose, index) => {
                    const poseItem = document.createElement('div');
                    poseItem.className = 'pose-item';
                    poseItem.innerHTML = `
                        <span>${index + 1}. ${pose.name}</span>
                        <span>${pose.keyframes.length} keyframes</span>
                    `;
                    poseItem.onclick = () => this.selectPose(index);
                    poseList.appendChild(poseItem);
                });
            }

            selectPose(index) {
                this.currentPoseIndex = index;
                this.drawPose(index);
                this.updateCurrentPose();
                document.querySelectorAll('.pose-item').forEach((item, i) => {
                    item.classList.toggle('active', i === index);
                });
            }

            drawPose(index) {
                if (!this.currentSequence[index]) return;
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                // Stylized stick figure for choreography
                const pose = this.currentSequence[index];
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                this.ctx.strokeStyle = '#f27121';
                this.ctx.lineWidth = 4;
                this.ctx.shadowColor = '#f27121';
                this.ctx.shadowBlur = 10;
                // Head
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY - 80, 25, 0, 2 * Math.PI);
                this.ctx.stroke();
                // Body
                this.ctx.beginPath();
                this.ctx.moveTo(centerX, centerY - 55);
                this.ctx.lineTo(centerX, centerY + 40);
                this.ctx.stroke();
                // Arms
                this.ctx.beginPath();
                this.ctx.moveTo(centerX - 40, centerY - 20);
                this.ctx.lineTo(centerX + 40, centerY - 20);
                this.ctx.stroke();
                // Legs
                this.ctx.beginPath();
                this.ctx.moveTo(centerX, centerY + 40);
                this.ctx.lineTo(centerX - 25, centerY + 90);
                this.ctx.moveTo(centerX, centerY + 40);
                this.ctx.lineTo(centerX + 25, centerY + 90);
                this.ctx.stroke();
                // Add pose name
                this.ctx.fillStyle = '#e94560';
                this.ctx.font = '20px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(pose.name, centerX, centerY + 120);
            }

            playSequence() {
                if (this.isPlaying) return;
                this.isPlaying = true;
                this.animateSequence();
            }

            pauseSequence() {
                this.isPlaying = false;
            }

            resetSequence() {
                this.isPlaying = false;
                this.currentPoseIndex = 0;
                this.updateCurrentPose();
                if (this.currentSequence.length > 0) {
                    this.drawPose(0);
                }
            }

            animateSequence() {
                if (!this.isPlaying || this.currentSequence.length === 0) return;
                this.drawPose(this.currentPoseIndex);
                this.updateCurrentPose();
                this.currentPoseIndex = (this.currentPoseIndex + 1) % this.currentSequence.length;
                setTimeout(() => this.animateSequence(), this.playbackSpeed);
            }

            updateCurrentPose() {
                document.getElementById('currentPose').textContent =
                    `Pose: ${this.currentPoseIndex + 1}/${this.currentSequence.length}`;
            }

            async previewMoves() {
                // Fetch preview from backend
                const style = document.getElementById('danceStyleSelect').value;
                const previewModal = document.getElementById('previewModal');
                const previewContent = document.getElementById('previewContent');
                previewContent.innerHTML = '<div style="color:#999;">Loading...</div>';
                previewModal.style.display = 'flex';
                try {
                    const res = await fetch(`${BACKEND_URL}/choreography/preview`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ style })
                    });
                    if (res.ok) {
                        const data = await res.json();
                        if (data.moves && data.moves.length > 0) {
                            previewContent.innerHTML = data.moves.map((move, idx) => `
                                <div style="margin-bottom:18px;">
                                    <b style="color:#f27121;">${idx + 1}. ${move.name}</b>
                                    <div style="font-size:0.95em; margin-bottom:4px;">Duration: ${move.duration}s</div>
                                    <div style="font-size:0.93em; color:#aaa;">
                                        Keyframes:
                                        <pre style="background:#181818; color:#fff; border-radius:7px; padding:7px; font-size:0.92em; overflow-x:auto;">${JSON.stringify(move.keyframes, null, 2)}</pre>
                                    </div>
                                </div>
                            `).join('');
                        } else {
                            previewContent.innerHTML = '<div style="color:#999;">No moves found for this style.</div>';
                        }
                    } else {
                        previewContent.innerHTML = '<div style="color:#e94560;">Failed to load preview.</div>';
                    }
                } catch (e) {
                    previewContent.innerHTML = '<div style="color:#e94560;">Error: ' + e.message + '</div>';
                }
            }

            closePreview() {
                document.getElementById('previewModal').style.display = 'none';
            }
        }

        // Gallery Manager Class
        class GalleryManager {
            constructor() {
                this.poses = JSON.parse(localStorage.getItem('savedPoses') || '[]');
            }

            loadGallery() {
                const grid = document.getElementById('galleryGrid');
                grid.innerHTML = '';
                if (this.poses.length === 0) {
                    grid.innerHTML = '<div style="text-align: center; grid-column: 1/-1; color: #999;">No poses saved yet</div>';
                    // Add clear button only if poses exist
                    document.getElementById('galleryClearBtn')?.remove();
                    return;
                }
                this.poses.forEach((pose, index) => {
                    const item = document.createElement('div');
                    item.className = 'gallery-item';
                    item.innerHTML = `
                        <div class="gallery-thumbnail" style="background-image:url('${pose.img || ''}'); background-size:cover; background-position:center;"></div>
                        <h3>${pose.name}</h3>
                        <p>${new Date(pose.timestamp).toLocaleDateString()}</p>
                        <button class="btn" onclick="window.galleryManager.deletePose(${index})">Delete</button>
                    `;
                    grid.appendChild(item);
                });
                // Add clear all button
                if (!document.getElementById('galleryClearBtn')) {
                    const clearBtn = document.createElement('button');
                    clearBtn.id = 'galleryClearBtn';
                    clearBtn.className = 'btn secondary';
                    clearBtn.textContent = 'Clear Gallery';
                    clearBtn.onclick = () => this.clearGallery();
                    grid.parentElement.insertBefore(clearBtn, grid);
                }
            }

            addPose(name, timestamp, img) {
                this.poses.push({ name, timestamp, img });
                localStorage.setItem('savedPoses', JSON.stringify(this.poses));
                this.loadGallery();
            }

            deletePose(index) {
                this.poses.splice(index, 1);
                localStorage.setItem('savedPoses', JSON.stringify(this.poses));
                this.loadGallery();
            }

            clearGallery() {
                if (confirm("Clear all saved poses?")) {
                    this.poses = [];
                    localStorage.removeItem('savedPoses');
                    this.loadGallery();
                }
            }
        }

        // About Page Loader
        async function loadAboutPage() {
            const aboutDiv = document.getElementById('aboutContent');
            const aboutTeam = document.getElementById('aboutTeam');
            const aboutPhantomDance = document.getElementById('aboutPhantomDance');
            const aboutContact = document.getElementById('aboutContact');
            aboutDiv.innerHTML = '<div style="text-align:center; color:#aaa;">Loading...</div>';
            aboutTeam.innerHTML = '';
            aboutPhantomDance.innerHTML = '';
            aboutContact.innerHTML = '';

            try {
                const res = await fetch(`${BACKEND_URL}/about`);
                if (!res.ok) throw new Error("Failed to load");
                const data = await res.json();
                aboutDiv.innerHTML = `
                    <div style="margin-bottom:24px;">
                        <p style="font-size:1.15rem; line-height:1.7; text-align:center;">
                            <b>${data.app}</b> - ${data.description}
                        </p>
                    </div>
                    <div style="background:rgba(233,69,96,0.08); border-radius:12px; padding:18px; margin-bottom:24px;">
                        <h3 style="color:#f27121;">Indian Dance Heritage</h3>
                        <ul>
                            ${data.heritage.map(h => `<li><b>${h.style}:</b> ${h.desc}</li>`).join('')}
                        </ul>
                    </div>
                    <div style="margin-bottom:24px;">
                        <h3 style="color:#f27121;">Our Mission</h3>
                        <p>${data.mission}</p>
                    </div>
                    <div style="color:#aaa; text-align:right;">Version: ${data.version}</div>
                `;
                aboutTeam.innerHTML = `
                    <div style="background:rgba(30,30,60,0.7); border-radius:12px; padding:18px;">
                        <h3 style="color:#f27121;">Our Team</h3>
                        <ul style="list-style:none; padding:0;">
                            ${data.team && Array.isArray(data.team)
                                ? data.team.map(member => `<li><b>${member.name}</b> â€“ ${member.role}</li>`).join('')
                                : `<li><b>Reya Garg</b> â€“ Full Stack Developer</li>`}
                        </ul>
                    </div>
                `;
                aboutPhantomDance.innerHTML = `
                    <div style="background:rgba(242,113,33,0.07); border-radius:12px; padding:18px;">
                        <h3 style="color:#e94560;">PhantomDance Dataset</h3>
                        <p>
                            <b>PhantomDance</b> is an open choreography dataset powering the Virtual Dance Instructor and Choreography Generator.<br>
                            <span style="color:#f27121;">You can select reference moves directly from this curated library for live feedback and practice.</span>
                        </p>
                        <ul style="margin-top:10px;">
                            <li>Includes authentic Indian and global dance steps</li>
                            <li>Used for both real-time feedback and pre-built choreography</li>
                        </ul>
                        <div style="margin-top:10px; font-size:0.95em; color:#aaa;">
                            <b>Source:</b> <a href="https://github.com/libuyu/PhantomDanceDataset" target="_blank" style="color:#f27121;">PhantomDance on GitHub</a>
                        </div>
                    </div>
                `;
                aboutContact.innerHTML = `
                    <div style="background:rgba(233,69,96,0.08); border-radius:12px; padding:18px;">
                        <h3 style="color:#f27121;">Contact & Credits</h3>
                        <p>
                            For feedback, collaboration, or dataset contributions:<br>
                            <a href="mailto:reyagarg13@gmail.com" style="color:#f27121;">reyagarg13@gmail.com</a>
                        </p>
                        <p style="font-size:0.95em; color:#aaa;">
                            Special thanks to the open-source dance and AI communities.
                        </p>
                    </div>
                `;
            } catch {
                aboutDiv.innerHTML = '<div style="color:#e94560; text-align:center;">Could not load about info.</div>';
            }
        }

        // --- Enhanced Virtual Dance Instructor ---
        class VirtualDanceInstructor {
            constructor() {
                this.reference = null;
                this.isRunning = false;
                this.expectedLandmarks = null;
                this.poseInstance = null;
                this.camera = null;
                this.styles = [];
                this.moves = {};
                this.motionLabels = [];
                this.lastSimilarity = null;
                this.similarityHistory = [];
                this.feedbackDetails = null;
                this.feedbackTimer = null;
            }

            async init() {
                await this.populateStyleSelect();
                document.getElementById('instructorStyleSelect').onchange = () => this.populateEnhancedMotionDropdown();
                document.getElementById('instructorMoveSelect').onchange = () => this.clearStatus();
                document.getElementById('previewInstructorMoveBtn').onclick = () => this.previewMove();
                document.getElementById('closeInstructorPreviewBtn').onclick = () => this.closePreview();
                document.getElementById('loadInstructorMoveBtn').onclick = () => this.loadSelectedMove();
                document.getElementById('instructorStartBtn').onclick = () => this.start();
                document.getElementById('instructorStopBtn').onclick = () => this.stop();
                document.getElementById('instructorStatus').textContent = '';
                document.getElementById('instructorFeedback').textContent = '';
                document.getElementById('instructorVideo').style.display = 'none';
                document.getElementById('instructorWebcam').style.display = 'none';
                document.getElementById('instructorReferenceCanvas').style.display = '';
                this.expectedLandmarks = null;
                this.referenceAnimation = null;
                this.similarityHistory = [];
                this.feedbackDetails = null;
                this.renderFeedbackChart();
                this.renderDetailedFeedback();
            }

            async populateStyleSelect() {
                const styleSelect = document.getElementById('instructorStyleSelect');
                styleSelect.innerHTML = `<option value="">-- Select style --</option>`;
                try {
                    const res = await fetch(`${BACKEND_URL}/choreography/styles`);
                    const data = await res.json();
                    this.styles = data.styles;
                    for (const style of this.styles) {
                        const opt = document.createElement('option');
                        opt.value = style;
                        opt.textContent = style.charAt(0).toUpperCase() + style.slice(1);
                        styleSelect.appendChild(opt);
                    }
                } catch {
                    styleSelect.innerHTML += `<option value="bollywood">Bollywood</option>
                        <option value="kathak">Kathak</option>
                        <option value="hiphop">Hip-Hop</option>
                        <option value="contemporary">Contemporary</option>
                        <option value="ballet">Ballet</option>`;
                }
                await this.populateEnhancedMotionDropdown();
            }

            async populateEnhancedMotionDropdown() {
                const style = document.getElementById('instructorStyleSelect').value;
                const moveSelect = document.getElementById('instructorMoveSelect');
                moveSelect.innerHTML = `<option value="">-- Select move --</option>`;
                if (!style) return;
                try {
                    const res = await fetch(`${BACKEND_URL}/choreography/preview`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ style })
                    });
                    const data = await res.json();
                    let moves = [];
                    if (Array.isArray(data)) {
                        moves = data;
                    } else if (Array.isArray(data.moves)) {
                        moves = data.moves;
                    }
                    if (moves.length > 0) {
                        for (const move of moves) {
                            let moveName = typeof move === "string" ? move : move.name || move.label || move.motion || "";
                            if (!moveName) continue;
                            const opt = document.createElement('option');
                            opt.value = moveName;
                            let duration = move.duration || (move.meta && move.meta.duration) || "";
                            opt.textContent = moveName + (duration ? ` (${duration}s)` : "");
                            moveSelect.appendChild(opt);
                        }
                    } else {
                        moveSelect.innerHTML += `<option value="">No moves found</option>`;
                    }
                } catch (err) {
                    moveSelect.innerHTML += `<option value="">No moves found</option>`;
                }
            }

            clearStatus() {
                document.getElementById('instructorStatus').textContent = '';
                document.getElementById('instructorFeedback').textContent = '';
                this.similarityHistory = [];
                this.renderFeedbackChart();
            }

            async previewMove() {
                const style = document.getElementById('instructorStyleSelect').value;
                const moveName = document.getElementById('instructorMoveSelect').value;
                if (!style || !moveName) {
                    document.getElementById('instructorStatus').textContent = 'Select a style and move.';
                    return;
                }
                try {
                    const res = await fetch(`${BACKEND_URL}/choreography/move?style=${encodeURIComponent(style)}&name=${encodeURIComponent(moveName)}`);
                    const move = await res.json();
                    if (move.keyframes && move.keyframes.length > 0) {
                        const previewModal = document.getElementById('instructorPreviewModal');
                        const previewContent = document.getElementById('instructorPreviewContent');
                        previewContent.innerHTML = `
                            <b style="color:#f27121;">${move.name}</b>
                            <div style="font-size:0.95em; margin-bottom:4px;">Duration: ${move.duration || ""}s</div>
                            <div style="font-size:0.93em; color:#aaa;">
                                Keyframes:
                                <pre style="background:#181818; color:#fff; border-radius:7px; padding:7px; font-size:0.92em; overflow-x:auto;">${JSON.stringify(move.keyframes, null, 2)}</pre>
                            </div>
                        `;
                        previewModal.style.display = 'flex';
                    } else {
                        document.getElementById('instructorStatus').textContent = 'No keyframes for this move.';
                    }
                } catch {
                    document.getElementById('instructorStatus').textContent = 'Could not load move preview.';
                }
            }

            closePreview() {
                document.getElementById('instructorPreviewModal').style.display = 'none';
            }

            async loadSelectedMove() {
                const style = document.getElementById('instructorStyleSelect').value;
                const moveName = document.getElementById('instructorMoveSelect').value;
                if (!style || !moveName) {
                    document.getElementById('instructorStatus').textContent = 'Select a style and move.';
                    this.expectedLandmarks = null;
                    return;
                }
                try {
                    const res = await fetch(`${BACKEND_URL}/choreography/move?style=${encodeURIComponent(style)}&name=${encodeURIComponent(moveName)}`);
                    if (!res.ok) {
                        const err = await res.json().catch(() => ({}));
                        document.getElementById('instructorStatus').textContent = err.detail ? `Error: ${err.detail}` : 'Could not load move.';
                        this.expectedLandmarks = null;
                        return;
                    }
                    const move = await res.json();
                    if (move.landmarks && Array.isArray(move.landmarks) && move.landmarks.length > 0) {
                        this.reference = { type: 'pose', landmarks: move.landmarks, name: move.name, style: move.style };
                        this.expectedLandmarks = move.landmarks;
                        document.getElementById('instructorStatus').textContent = `Loaded: ${move.name}`;
                        this.showReferenceAnimation(move);
                    } else if (move.keyframes && Array.isArray(move.keyframes) && move.keyframes.length > 0) {
                        this.reference = { type: 'keyframes', keyframes: move.keyframes, name: move.name, style: move.style };
                        this.expectedLandmarks = Array.from({length: 33}, () => ({x: 0, y: 0, z: 0, visibility: 0}));
                        document.getElementById('instructorStatus').textContent = `Loaded: ${move.name} (keyframes only)`;
                        this.showReferenceAnimation(move);
                    } else {
                        document.getElementById('instructorStatus').textContent = 'Selected move has no reference pose or keyframes.';
                        this.expectedLandmarks = null;
                    }
                } catch (err) {
                    document.getElementById('instructorStatus').textContent = 'Could not load move.';
                    this.expectedLandmarks = null;
                }
            }

            showReferenceAnimation(move) {
                // Enhanced: Draw stick figure if landmarks exist, else show move name
                const canvas = document.getElementById('instructorReferenceCanvas');
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if (move.landmarks && Array.isArray(move.landmarks) && move.landmarks.length > 0) {
                    // Draw landmarks as stick figure
                    this.drawStickFigure(ctx, move.landmarks, canvas.width, canvas.height);
                } else {
                    ctx.fillStyle = '#f27121';
                    ctx.font = '24px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(move.name, canvas.width / 2, canvas.height / 2);
                }
            }

            drawStickFigure(ctx, landmarks, width, height) {
                // Simple stick figure drawing using MediaPipe connections
                const connections = [
                    [11, 13], [13, 15], [12, 14], [14, 16], // arms
                    [11, 12], // shoulders
                    [23, 24], // hips
                    [11, 23], [12, 24], // torso
                    [23, 25], [25, 27], [24, 26], [26, 28], // legs
                    [27, 31], [28, 32], // feet
                ];
                ctx.save();
                ctx.strokeStyle = "#f27121";
                ctx.lineWidth = 4;
                // Scale normalized landmarks to canvas
                const pts = landmarks.map(lm => ({
                    x: lm.x * width,
                    y: lm.y * height
                }));
                // Draw lines
                for (const [a, b] of connections) {
                    if (pts[a] && pts[b]) {
                        ctx.beginPath();
                        ctx.moveTo(pts[a].x, pts[a].y);
                        ctx.lineTo(pts[b].x, pts[b].y);
                        ctx.stroke();
                    }
                }
                // Draw joints
                ctx.fillStyle = "#e94560";
                for (const pt of pts) {
                    ctx.beginPath();
                    ctx.arc(pt.x, pt.y, 6, 0, 2 * Math.PI);
                    ctx.fill();
                }
                ctx.restore();
            }

            async start() {
                if (this.isRunning) return;
                if (!Array.isArray(this.expectedLandmarks) || this.expectedLandmarks.length === 0) {
                    document.getElementById('instructorStatus').textContent = 'Load a move first.';
                    return;
                }
                this.isRunning = true;
                document.getElementById('instructorStatus').textContent = 'Instructor started. Please allow webcam access.';
                await this.startWebcam();
            }

            async startWebcam() {
                const video = document.getElementById('instructorVideo');
                const webcamCanvas = document.getElementById('instructorWebcam');
                const poseCanvas = document.getElementById('instructorPoseCanvas');
                video.style.display = 'none';
                webcamCanvas.style.display = '';
                poseCanvas.style.display = '';
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    video.srcObject = stream;
                    video.play();
                    webcamCanvas.width = video.videoWidth || 640;
                    webcamCanvas.height = video.videoHeight || 480;
                    poseCanvas.width = webcamCanvas.width;
                    poseCanvas.height = webcamCanvas.height;
                    this.similarityHistory = [];
                    this.feedbackDetails = null;
                    this.runPoseDetection(video, webcamCanvas, poseCanvas);
                } catch (e) {
                    document.getElementById('instructorStatus').textContent = 'Webcam access denied.';
                    this.isRunning = false;
                }
            }

            async runPoseDetection(video, webcamCanvas, poseCanvas) {
                if (!window.Pose) {
                    document.getElementById('instructorStatus').textContent = 'MediaPipe Pose not loaded.';
                    return;
                }
                const pose = new window.Pose({
                    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/${file}`
                });
                pose.setOptions({
                    modelComplexity: 1,
                    smoothLandmarks: true,
                    enableSegmentation: false,
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });
                pose.onResults(async (results) => {
                    const ctx = webcamCanvas.getContext('2d');
                    ctx.clearRect(0, 0, webcamCanvas.width, webcamCanvas.height);
                    ctx.drawImage(video, 0, 0, webcamCanvas.width, webcamCanvas.height);
                    if (results.poseLandmarks) {
                        window.drawLandmarks(ctx, results.poseLandmarks, "#f27121");
                        // Compare with expectedLandmarks
                        const liveLandmarks = results.poseLandmarks.map(lm => ({
                            x: lm.x,
                            y: lm.y,
                            z: lm.z || 0,
                            visibility: lm.visibility
                        }));
                        const sim = window.compareLandmarks(
                            liveLandmarks,
                            this.expectedLandmarks
                        );
                        this.lastSimilarity = sim;
                        this.similarityHistory.push(sim);
                        if (this.similarityHistory.length > 30) this.similarityHistory.shift();
                        this.renderFeedbackChart();

                        // Enhanced: Call backend for detailed feedback every 1s
                        if (!this.feedbackTimer) {
                            this.feedbackTimer = setInterval(() => {
                                this.sendDetailedFeedback(liveLandmarks, this.expectedLandmarks);
                            }, 1000);
                        }

                        let msg = '';
                        if (sim > 0.85) msg = 'Great! Your pose matches the instructor!';
                        else if (sim > 0.65) msg = 'Good! Try to match the pose more closely.';
                        else msg = 'Keep practicing to match the instructor pose!';
                        document.getElementById('instructorFeedback').innerHTML =
                            `<b>Similarity:</b> ${(sim*100).toFixed(1)}%<br>${msg}`;
                    }
                });
                const camera = new window.Camera(video, {
                    onFrame: async () => {
                        await pose.send({ image: video });
                    },
                    width: webcamCanvas.width,
                    height: webcamCanvas.height
                });
                camera.start();
                this.poseInstance = pose;
                this.camera = camera;
            }

            async sendDetailedFeedback(userLandmarks, expectedLandmarks) {
                // Only send if both are valid and not all zeros
                if (!userLandmarks || !expectedLandmarks || userLandmarks.length !== expectedLandmarks.length) return;
                if (userLandmarks.every(lm => !lm.x && !lm.y && !lm.z)) return;
                try {
                    const res = await fetch(`${BACKEND_URL}/feedback`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            user_landmarks: userLandmarks,
                            expected_landmarks: expectedLandmarks
                        })
                    });
                    if (res.ok) {
                        const data = await res.json();
                        this.feedbackDetails = data;
                        this.renderDetailedFeedback();
                    }
                } catch {}
            }

            renderFeedbackChart() {
                // Add a simple sparkline chart for similarity history
                let chartId = "instructorFeedbackChart";
                let chartDiv = document.getElementById(chartId);
                if (!chartDiv) {
                    chartDiv = document.createElement("div");
                    chartDiv.id = chartId;
                    chartDiv.style.margin = "10px 0";
                    chartDiv.style.height = "40px";
                    chartDiv.style.width = "100%";
                    chartDiv.style.background = "#181818";
                    chartDiv.style.borderRadius = "8px";
                    chartDiv.style.display = "flex";
                    chartDiv.style.alignItems = "flex-end";
                    chartDiv.style.justifyContent = "center";
                    document.getElementById('instructorFeedback').appendChild(chartDiv);
                }
                chartDiv.innerHTML = "";
                const history = this.similarityHistory;
                if (!history || history.length === 0) {
                    chartDiv.innerHTML = "<span style='color:#aaa;font-size:0.9em;'>No feedback yet</span>";
                    return;
                }
                const max = 1, min = 0;
                const w = chartDiv.offsetWidth || 200;
                const h = chartDiv.offsetHeight || 40;
                const barW = Math.max(2, Math.floor(w / history.length));
                for (let i = 0; i < history.length; ++i) {
                    const val = history[i];
                    const bar = document.createElement("div");
                    bar.style.display = "inline-block";
                    bar.style.width = barW + "px";
                    bar.style.height = ((val - min) / (max - min) * h) + "px";
                    bar.style.marginRight = "1px";
                    bar.style.background = val > 0.85 ? "#4caf50" : val > 0.65 ? "#ffc107" : "#e94560";
                    bar.title = (val*100).toFixed(1) + "%";
                    chartDiv.appendChild(bar);
                }
            }

            renderDetailedFeedback() {
                // Show detailed feedback below the chart if available
                let detailsDiv = document.getElementById("instructorFeedbackDetails");
                if (!detailsDiv) {
                    detailsDiv = document.createElement("div");
                    detailsDiv.id = "instructorFeedbackDetails";
                    detailsDiv.style.margin = "8px 0 0 0";
                    detailsDiv.style.fontSize = "0.98em";
                    detailsDiv.style.color = "#fff";
                    document.getElementById('instructorFeedback').appendChild(detailsDiv);
                }
                if (!this.feedbackDetails || !this.feedbackDetails.details) {
                    detailsDiv.innerHTML = "";
                    return;
                }
                const { score, feedback, details } = this.feedbackDetails;
                let html = `<div style="color:#f27121;"><b>AI Feedback:</b> ${feedback} <span style="color:#aaa;">(Score: ${score})</span></div>`;
                if (details && details.joint_feedback && details.joint_feedback.length > 0) {
                    // Show top 2 joints needing improvement
                    const sorted = [...details.joint_feedback].sort((a, b) => b.distance - a.distance);
                    html += `<div style="margin-top:6px;">`;
                    for (let i = 0; i < Math.min(2, sorted.length); ++i) {
                        const j = sorted[i];
                        if (j.distance < 0.07) continue;
                        html += `<span style="color:#e94560;">${j.landmark}:</span> <span style="color:#ffc107;">${j.distance.toFixed(2)}</span> `;
                    }
                    html += `</div>`;
                }
                detailsDiv.innerHTML = html;
            }

            stop() {
                this.isRunning = false;
                if (this.camera && this.camera.stop) this.camera.stop();
                if (this.feedbackTimer) {
                    clearInterval(this.feedbackTimer);
                    this.feedbackTimer = null;
                }
                document.getElementById('instructorStatus').textContent = 'Instructor stopped.';
                document.getElementById('instructorFeedback').textContent = '';
                document.getElementById('instructorWebcam').style.display = 'none';
                document.getElementById('instructorPoseCanvas').style.display = 'none';
                this.similarityHistory = [];
                this.feedbackDetails = null;
                this.renderFeedbackChart();
                this.renderDetailedFeedback();
            }
        }

        // Initialize Application
        document.addEventListener('DOMContentLoaded', () => {
            window.router = new Router();
            window.liveTracker = new LiveTracker();
            window.choreoGenerator = new ChoreographyGenerator();
            window.galleryManager = new GalleryManager();
            window.virtualInstructor = new VirtualDanceInstructor();

            // About page navigation support
            document.querySelectorAll('[data-page="about"]').forEach(el => {
                el.addEventListener('click', e => {
                    e.preventDefault();
                    window.router.navigateTo('about');
                    loadAboutPage();
                });
            });

            // Virtual Dance Instructor navigation support
            document.querySelectorAll('[data-page="instructor"]').forEach(el => {
                el.addEventListener('click', e => {
                    e.preventDefault();
                    window.router.navigateTo('instructor');
                    window.virtualInstructor.init();
                });
            });

            // Make logo clickable to go to home
            document.getElementById('navHome').addEventListener('click', e => {
                e.preventDefault();
                window.router.navigateTo('home');
            });

            // Load about page if navigated directly
            if (window.location.hash === "#about" || window.router.currentPage === "about") {
                window.router.navigateTo('about');
                loadAboutPage();
            }
        });
    </script>
</body>
</html>